---
name: logstash

templates:
  bin/ctl: bin/ctl
  bin/post-start: bin/post-start
  bin/ctl_utils.sh: bin/ctl_utils.sh
  bin/tcp_probe.py: bin/tcp_probe.py
  config/logstash.conf: config/logstash.conf
  config/logstash.yml: config/logstash.yml
  config/tls.crt: config/tls.crt
  config/tls.key: config/tls.key
  config/env.sh: config/env.sh
  config/elasticsearch-hosts: config/elasticsearch-hosts
  config/elasticsearch-ca.crt: config/elasticsearch-ca.crt

packages:
- logstash
- python2.7

consumes:
- name: elasticsearch
  type: elasticsearch
  optional: true

properties:
  logstash.conf:
    default: |-
      input {  tcp { port => 5514 } } output { stdout { codec => json_lines } }
    description: logstash.conf
  logstash.tls.certificate:
    description: |-
      TLS certificate that is stored in /var/vcap/jobs/logstash/config/tls.crt

      You can enable tls for tcp input plugin as follows
      input {
        tcp {
          add_field => [ "type", "syslog" ]
          port => "5514"
          ssl_enable => true
          ssl_cert => "/var/vcap/jobs/logstash/config/tls.crt"
          ssl_key => "/var/vcap/jobs/logstash/config/tls.key"
          ssl_verify => false
        }
      }
  logstash.tls.private_key:
    description: TLS private key that is stored in /var/vcap/jobs/logstash/config/tls.key
  logstash.env:
    description: A hash of envrioment varibales
  logstash.readiness_probe_http_port:
    description: HTTP port to check the readiness of Logstash server. Set 0 to disable the http readiness probe.
    default: 9600
  logstash.readiness_probe_tcp_port:
    description: TCP port to check the readiness of Logstash server. Set 0 to disable the TCP readiness probe.
    default: 0
  logstash.kill_and_wait_timeout:
    default: timeout for kill_and_wait function
    default: 5
  logstash.sigkill_on_timeout:
    default: Whether to send kill signal on timeout
    default: true
  elasticsearch.hosts:
    description: The list of elasticsearch node IPs
    default: []
  elasticsearch.protocol:
    description: "Protocl of elasticsearch to send elasticsearch requests to (http or https)"
    default: "http"
  elasticsearch.port:
    description: "Port of elasticsearch to send elasticsearch requests to"
    default: "9200"
  elasticsearch.username:
    description: "The username of basic authentication on Elasticsearch"
  elasticsearch.password:
    description: "The password of basic authentication on Elasticsearch"
  xpack.monitoring.enabled:
    description: "Monitoring is disabled by default. Set to `true` to enable X-Pack monitoring."
  xpack.monitoring.elasticsearch.url:
    description: "The Elasticsearch instances that you want to ship your Logstash metrics to. This might be the same Elasticsearch instance specified in the `outputs` section in your Logstash configuration, or a different one. This is not the URL of your dedicated monitoring cluster. Even if you are using a dedicated monitoring cluster, the Logstash metrics must be routed through your production cluster. You can specify a single host as a string, or specify multiple hosts as an array. Defaults to `http://localhost:9200`."
  xpack.monitoring.elasticsearch.username:
    description: "If your Elasticsearch is protected with basic authentication, these settings provide the username and password that the Logstash instance uses to authenticate for shipping monitoring data."
  xpack.monitoring.elasticsearch.password:
    description: "If your Elasticsearch is protected with basic authentication, these settings provide the username and password that the Logstash instance uses to authenticate for shipping monitoring data."
  xpack.monitoring.collection.interval:
    description: "Controls how often data samples are collected and shipped on the Logstash side. Defaults to `10s`. If you modify the collection interval, set the `xpack.monitoring.min_interval_seconds` option in `kibana.yml` to the same value."
  xpack.monitoring.elasticsearch.ssl.ca:
    description: "Optional setting that enables you to specify a path to the `.pem` file for the certificate authority for your Elasticsearch instance."
  xpack.monitoring.elasticsearch.ssl.certificate_authority: #After Logstash 6.7
    description: "Optional setting that enables you to specify a path to the `.pem` file for the certificate authority for your Elasticsearch instance."
  xpack.monitoring.elasticsearch.ssl.truststore.path:
    description: "Optional settings that provide the paths to the Java keystore (JKS) to validate the server’s certificate."
  xpack.monitoring.elasticsearch.ssl.truststore.password:
    description: "Optional settings that provide the password to the truststore."
  xpack.monitoring.elasticsearch.ssl.keystore.path:
    description: "Optional settings that provide the paths to the Java keystore (JKS) to validate the client’s certificate."
  xpack.monitoring.elasticsearch.ssl.keystore.password:
    description: "Optional settings that provide the password to the keystore."
  xpack.monitoring.elasticsearch.ssl.verification_mode:
    description: |
      "Controls the verification of certificates. Valid values are:"
      "- `full`, which verifies that the provided certificate is signed by a trusted authority (CA) and also verifies that the server’s hostname (or IP address) matches the names identified within the certificate."
      "- `certificate`, which verifies that the provided certificate is signed by a trusted authority (CA), but does not perform any hostname verification."
      "- `none`, which performs no verification of the server’s certificate. This mode disables many of the security benefits of SSL/TLS and should only be used after very careful consideration. It is primarily intended as a temporary diagnostic mechanism when attempting to resolve TLS errors, and its use on production clusters is strongly discouraged."
      "- The default value is `full`."